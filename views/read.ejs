<%- include('./includes/head.ejs') %>
<%- include('./includes/nav.ejs') %>

<body style="    background-color: var(--light);">
    <%- messages()%>
    <h1 class="heading" >
        <% if(follow!==3    ){ %>
            <% if(userblog){ %> <%=name%>'s Blogs<%}else{%> <%=heading%><%}%>
        <%}else{%>
            Your Profile
        <%}%>
        
    </h1>

    
    
    <% if(follow!==0    ){ %>
    <div class="card" style="max-width: 22%;" >
        <!-- <img class="card-img-top" src="/<%= user.imageUrl %>" alt="<%=user.imageUrl%>"> -->
        <h1 style="padding-top: 5%;"><%= user.name%></h1><hr>
        <p class="title" style="color: grey;font-size: 18px;"> <%= user.email%></p>
        <p class="title" style="color: grey;font-size: 18px;">Followers: <a href="/followers/<%=user.name%>"><%= user.followers.length%></a></p>
        <p class="title" style="color: grey;font-size: 18px;">Following: <a href="/following/<%=user.name%>"><%= user.following.length%></a></p>
        <p class="title" style="color: grey;font-size: 18px;">Total Blogs: <%=posts.length%></p>
        
        <% if(follow===1 ){ %>
            <form action="/follow/<%=author%>" method="GET" style="border: none;margin: 0%;padding: 0%;border-radius: 0%;">
                <button class="btn btn-primary" value="save" type="submit" style="width: 100%; border-radius: 0;">
                    Follow 
                </button>    
            </form>
        <%} %>
        <% if(follow===2 ){ %>
            <form action="/unfollow/<%=author%>" method="GET" style="border: none;margin: 0%;padding: 0%;border-radius: 0%;">
                <button class="btn btn-danger" value="save" type="submit" style="width: 100%; border-radius: 0;">
                    Unfollow 
                </button>    
            </form>
        <%} %>
        
    </div>
    <h2 class="centered" style="font-family: 'Merriweather', serif;">
        Blogs written by <%= user.name%>
   </h2>
    <%}else{%>
        <% if (explore) { %>
            <div >
                <form action="/categories/find" method="POST" style="border: none;margin: 0%;padding: 1% 2%;">
                    <select   style="margin-left: 35%;
                    width: 30%;
                    border: 1px solid transparent;
                    box-shadow: 0 2px 5px 1px rgba(64,60,67,.16);
                    height: 3rem;
                    padding: 0 2%;
                    margin-right: 1rem;
                    border-radius: 24px; "  name="category" >
                        <option > Search by Category </option>
                        <%for(var i=0; i < categories.length; i++) {%>
                            <option id="categorySearch" value="<%= categories[i].name%>"><a href="/categories/findCategory/<%= categories[i].name%>"><%= categories[i].name%></a></option>
                        <% } %>
                        
                    </select>
                    <button id="search" class="btn btn-primary" type="submit">
                        Search 
                    </button>
                </form>  
            </div>
        <%}%>
    <%}%>
    <% for(var i=posts.length-1; i >= 0; i--) { %>
        <div class="media border p-3 blog" >
            <img src="/<%= posts[i].imageUrl %>" alt="Post Image" class="mr-3 mt-3 rounded" style="width:250px;margin-left: 2%;">
            <div class="media-body " style="margin: 1.5% 1%;">
                
                <h2 >
                    <a  href="/read/<%=posts[i]._id%>" style="color: #1e252c">
                        <strong id="increaseView" style="
                        font-family: 'Merriweather', serif;
                        /* font-family: 'Roboto Slab', serif; */
                        " >
                            <%=posts[i].title%>
                        </strong>
                    </a> 
                </h2>
                <small>
                    <hr>
                    <h6 ><i>Posted in 
                        <a href="/categories/findCategory/<%=posts[i].category%>" class="sorting-links" ><strong><%=posts[i].category%></strong></a> 
                    by  <a href="/categories/findAuthor/<%=posts[i].author%>" class="sorting-links"><strong><%=posts[i].author%></strong></a> 
                    on  <%=moment(posts[i].date).format("MM-DD-YYYY")%>
                    </i></h6>
                </small>
                <hr>
                <% if(posts[i].body.length>=300){ %> 
                    <h5><%- posts[i].body.substring(0, 300) %>...</h5>
                    <a class="sorting-links" style="font-weight: bold;font-family: 'Merriweather', serif; " href="/read/<%=posts[i]._id%>">Read more</a>    
                <% }else{ %>
                   <h5><%- posts[i].body%></h5>
                <% }  %>
                
                
                <% if (userblog) { %>
                    <hr>
                    <button class="btn " style="background-color: #00adb5;    margin: 0 0.5%;" type="submit"> <a href="/posts/edit/<%=posts[i]._id%>" style="color: white;text-decoration: none;">edit</a> </button>
                    <button class="btn " style="background-color: #ec625f;    margin: 0 0.5%;" type="submit" ><a href="/posts/delete/<%=posts[i]._id%>" style="color: white;text-decoration: none;">delete</a> </button>
                <% } %>
                <hr>
                <h5 style="color: var(--primary);font-family: 'Merriweather', serif;">Likes: <%=posts[i].likes.length%>     <a href="/read/<%=posts[i]._id%>" ">    Comments: <%=posts[i].comments.length%></a></h5>
                
            </div>
        </div>
    <% } %>
</body>

<script>
    
    


</script>

<%- include('./includes/footer.ejs') %>


     
